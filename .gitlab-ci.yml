image: docker:latest

services:
  - docker:dind

variables:
  DOCKER_HOST: tcp://docker:2375

stages:
  - container
  - cluster

container:
  stage: container
  tags:
    - k8s-runner
  script:
    - docker build -t camillamartins/dockernode:$CI_PIPELINE_ID .
    - docker push camillamartins/dockernode:$CI_PIPELINE_ID

cluster:
  image: bitnami/kubectl
  stage: cluster
  tags:
    - k8s-runner
  script:
    - kubectl apply -f deployment.yaml
